---
title: "SHAP_Analysis"
output:
  word_document: default
  html_document: default
date: "2023-01-31"
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, fig.align = "center", warning = F, message = F, R.options=list(max.print=100))
```

```{R}
library(tidyverse)
library(dplyr)
library(scales)

shap_data <- All_Housing_Data
```

# Absolute Average Contribution - SHAP

```{r}

shap_data %>% select(-c("...1")) %>% select(-('Close Price':'Year Built')) %>%
  select_if(is.numeric) %>% abs() %>% summarise_all(mean) %>% t() %>% 
  format(scientific = FALSE)

```

# Closing Price & Green Energy Efficient SHAP Values

```{r}

shap_data %>% select ('Close Price', 'Green Energy Efficient_SHAP', 'Green Energy Efficient') %>% na.omit() %>%
  rename(price='Close Price', efficient_SHAP='Green Energy Efficient_SHAP', green_energy='Green Energy Efficient') %>% 
  mutate(green_energy = as.character(green_energy)) %>%
  ggplot(aes(x = price, y = efficient_SHAP, color = green_energy)) + geom_point(alpha = 0.1, size = 0.1) + geom_smooth(size = 1) +
  coord_cartesian(ylim = c(-0.005, 0.005)) + 
  labs(title="Closing Price vs Green Energy Efficient SHAP Values", x="Closing Price", y="SHAP Values", color="Green Energy Efficient") +
  theme(plot.title = element_text(hjust = 0.5))  

```

# Closing Price & Green Sustainability SHAP Values

```{r}

shap_data %>% select ('Close Price', 'Green Sustainability_SHAP', 'Green Sustainability') %>% na.omit() %>%
  rename(price='Close Price', sustainability_SHAP='Green Sustainability_SHAP', green_sustainability='Green Sustainability') %>%
  mutate(green_sustainability = as.character(green_sustainability)) %>%
  ggplot(aes(x = price, y = sustainability_SHAP, color = green_sustainability)) + geom_point(alpha = 0.1, size = 0.1) +
  geom_smooth(size = 1) + coord_cartesian(ylim = c(-0.005, 0.005)) +
  labs(title="Closing Price vs Green Sustainability SHAP Values", x="Closing Price", y="SHAP Values", color="Green Sustainability") +
  theme(plot.title = element_text(hjust = 0.5))  

```

# Square Feet & Green Energy Efficient SHAP Values

```{r}

shap_data %>% select ('Square Feet', 'Green Energy Efficient_SHAP', 'Green Energy Efficient') %>% na.omit() %>%
  rename(sqft='Square Feet', efficient_SHAP='Green Energy Efficient_SHAP', green_energy='Green Energy Efficient') %>% 
  mutate(green_energy = as.character(green_energy)) %>%
  ggplot(aes(x = sqft, y = efficient_SHAP, color = green_energy)) + geom_point(alpha = 0.1, size = 0.1) + geom_smooth(size = 1) +
  scale_x_continuous(trans='log', labels = label_number(accuracy = 1)) + coord_cartesian(ylim = c(-0.005, 0.005)) +
  labs(title="Square Feet vs Green Energy Efficient SHAP Values", x="Square Feet", y="SHAP Values", color="Green Energy Efficient") +
  theme(plot.title = element_text(hjust = 0.5))  

```

# Square Feet & Green Sustainability SHAP Values

```{r}

shap_data %>% select ('Square Feet', 'Green Sustainability_SHAP', 'Green Sustainability') %>% na.omit() %>%
  rename(sqft='Square Feet', sustainability_SHAP='Green Sustainability_SHAP', green_sustainability='Green Sustainability') %>% 
  mutate(green_sustainability = as.character(green_sustainability)) %>%
  ggplot(aes(x = sqft, y = sustainability_SHAP, color = green_sustainability)) + geom_point(alpha = 0.1, size = 0.1) + 
  geom_smooth(size = 1) + scale_x_continuous(trans='log', labels = label_number(accuracy = 1)) + coord_cartesian(ylim = c(-0.005, 0.005)) +
  labs(title="Square Feet vs Green Sustainability SHAP Values", x="Square Feet", y="SHAP Values", color="Green Sustainability") +
  theme(plot.title = element_text(hjust = 0.5))  

```

# Year Built & Green Energy Efficient SHAP Values

```{r}

shap_data %>% select ('Year Built', 'Green Energy Efficient_SHAP', 'Green Energy Efficient') %>% na.omit() %>%
  rename(year_built='Year Built', efficient_SHAP='Green Energy Efficient_SHAP', green_energy='Green Energy Efficient') %>% 
  mutate(green_energy = as.character(green_energy)) %>%
  ggplot(aes(x = year_built, y = efficient_SHAP, color = green_energy)) + geom_point(alpha = 0.1, size = 0.1) + geom_smooth(size = 1) +
  scale_x_continuous(n.breaks = 10, labels = label_number(accuracy = 1)) + coord_cartesian(ylim = c(-0.005, 0.005)) +
  labs(title="Year Built vs Green Energy Efficient SHAP Values", x="Year Built", y="SHAP Values", color="Green Energy Efficient") +
  theme(plot.title = element_text(hjust = 0.5)) 

```

# Year Built & Green Sustainability SHAP Values

```{r}

shap_data %>% select ('Year Built', 'Green Sustainability_SHAP', 'Green Sustainability') %>% na.omit() %>%
  rename(year_built='Year Built', sustainability_SHAP='Green Sustainability_SHAP', green_sustainability='Green Sustainability') %>% 
  mutate(green_sustainability = as.character(green_sustainability)) %>%
  ggplot(aes(x = year_built, y = sustainability_SHAP, color = green_sustainability)) + geom_point(alpha = 0.1, size = 0.1) +
  geom_smooth(size = 1) + scale_x_continuous(n.breaks=10, labels=label_number(accuracy = 1)) + coord_cartesian(ylim = c(-0.005, 0.005)) +  
  labs(title="Year Built vs Green Sustainability SHAP Values", x="Year Built", y="SHAP Values", color="Green Sustainability") +
  theme(plot.title = element_text(hjust = 0.5))  

```

# Month Sold & Green Energy Efficient SHAP Values

```{r}

shap_data %>% select ('Off Market Month', 'Green Energy Efficient_SHAP', 'Green Energy Efficient') %>% na.omit() %>%
  rename(month_sold='Off Market Month', efficient_SHAP='Green Energy Efficient_SHAP', green_energy='Green Energy Efficient') %>% 
  mutate(green_energy = as.character(green_energy)) %>%
  ggplot(aes(x = month_sold, y = efficient_SHAP, color = green_energy)) + geom_point(alpha = 0.1, size = 0.1) + geom_smooth(size = 1) +
  scale_x_continuous(n.breaks = 12, labels = label_number(accuracy = 1)) + coord_cartesian(ylim = c(-0.005, 0.005)) +
  labs(title="Month Sold vs Green Energy Efficient SHAP Values", x="Month Sold", y="SHAP Values", color="Green Energy Efficient") +
  theme(plot.title = element_text(hjust = 0.5))  

```

# Month Sold & Green Sustainability SHAP Values

```{r}

shap_data %>% select ('Off Market Month', 'Green Sustainability_SHAP', 'Green Sustainability') %>% na.omit() %>%
  rename(month_sold='Off Market Month', sustainability_SHAP='Green Sustainability_SHAP', green_sustainability='Green Sustainability') %>%
  mutate(green_sustainability = as.character(green_sustainability)) %>%
  ggplot(aes(x = month_sold, y = sustainability_SHAP, color = green_sustainability)) + geom_point(alpha = 0.1, size = 0.1) +
  geom_smooth(size = 1) + scale_x_continuous(n.breaks=12, labels=label_number(accuracy = 1)) + coord_cartesian(ylim = c(-0.005, 0.005)) +
  labs(title = "Month Sold vs Green Sustainability SHAP Values", x = "Month Sold", y = "SHAP Values", color = "Green Sustainability") +
  theme(plot.title = element_text(hjust = 0.5))  

```

# Year Sold & Green Energy Efficient SHAP Values

```{r}

shap_data %>% select ('Off Market Year', 'Green Energy Efficient_SHAP', 'Green Energy Efficient') %>% na.omit() %>%
  rename(year_sold='Off Market Year', efficient_SHAP='Green Energy Efficient_SHAP', green_energy='Green Energy Efficient') %>% 
  mutate(year_sold = as.character(year_sold)) %>% mutate(green_energy = as.character(green_energy)) %>% group_by(green_energy) %>%
  ggplot(aes(x = year_sold, y = efficient_SHAP, color = green_energy)) + geom_boxplot() + 
  labs(title = "Year Sold vs Green Energy Efficient SHAP Values", x = "Year Sold", y = "SHAP Values", color = "Green Energy Efficient") +
  theme(plot.title = element_text(hjust = 0.5))  

```